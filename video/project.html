<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>工规划程进度</title>
	<script src="http://apps.bdimg.com/libs/layer.m/1.5/layer.m.js"></script>
	<script src="http://apps.bdimg.com/libs/vue/1.0.8/vue.min.js"></script>
	<link href="http://apps.bdimg.com/libs/layer.m/1.5/need/layer.css" rel="stylesheet">
	<style type="text/css">
	.day_input{
		float: left;
		width:30%;
	}
	.day_list{
		float:left;
		width:40%;
	}
	.step_list{
		float:left;
		width:30%;
	}
	.day_input input{
		width:80px;
	}
	</style>
</head>
<body>

<div id="milk">

	<div class="day_input">
	起始天设置：<input v-model="beginYear" number/><input v-model="beginMonth" number/><input v-model="beginDay" number/>
	<br/>
	起始偏移量：<input v-model="start" number/><br/>
	<button v-on:click="init">init</button>

		<div v-for="step in steps">
		{{step.name}}<input v-model="step.day" number/>
		</div>
	</div>
	<div class="day_list">
	    <button v-on:click="fresh">fresh</button>
	    <li v-for="day in dayList">
	      <input  type="checkbox"  v-model="day.isFree">星期{{day.weekIndex}} : {{day.dateStr}} {{day.stepName}}
	    </li>
    </div>
</div>



</body>
<script type="text/javascript">

new Vue({
	  el: '#milk',
	  data: {
	  	beginDay:new Date().getDate(),
	  	beginMonth:new Date().getMonth()+1,
	  	beginYear:new Date().getFullYear(),
	    dayNum: 60,
	    start:1,
	    steps:[
				{day:3,name:"需求评审"},
				{day:3,name:"需求讲解"},
				{day:3,name:"开始编码"},
				{day:3,name:"编码结束"},
				{day:3,name:"SDV1"},
				{day:3,name:"SDV2"},
				{day:3,name:"SIT"},
				{day:3,name:"现网升级"}
	    ],
	    dayList:[]
	  },
	  computed: {
	  	totalDay:function(){
	  			var t = 0;
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				t+=this.steps[i].day;
	  			}
	  			return t;
	  	}
  	  },
	  methods: {
	  	init:function() {
	  		this.dayList=[];
	  		var bTime = new Date(this.beginYear,this.beginMonth-1,this.beginDay,0,0);
	  			for(i=1;i <= this.dayNum;i++)
	  			{
	  				var time = bTime.getTime();
	  				time += i*24*60*60*1000;
	  				var tempDate = new Date(time);
	  				var dateStr = tempDate.getFullYear()+"/"+(tempDate.getMonth() +1)+"/"+tempDate.getDate();
	  				var weekIndex = tempDate.getDay()+1;
	  				this.dayList.push({
	  					dateStr:dateStr,
	  					weekIndex:weekIndex,
	  					isFree:(weekIndex==6||weekIndex==7),
	  					stepName:""
	  				});
	  			}
	  	},
	  	fresh:function(){
	  			for(i=0;i < this.dayList.length;i++){
	  				this.dayList[i].stepName="";
	  			}
	  			var temp = 0;
	  			temp += this.start;
	  			this.dayList[temp].stepName = "需求澄清";
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				var j = 0;
	  				while(j<this.steps[i].day){
	  					if(this.dayList[temp].isFree){
	  						temp++;
	  						continue;
	  					}
	  					j++;
	  					temp++;
	  				}
	  				this.dayList[temp].stepName += (this.steps[i].name+";");
	  			}
	  	}
	  }
	});
</script>
</html>

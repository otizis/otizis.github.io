<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>工规划程进度</title>
	<script src="http://apps.bdimg.com/libs/vue/1.0.8/vue.min.js"></script>
<style type="text/css">
.day_input{
	position:absolute;
	top:230px;
}
.day_list{
	width: 155px;
	position: absolute;
	top: 230px;
	left: 260px;
}
.step_list{
	width: 200px;
	position: absolute;
	top: 230px;
	left: 415px;
}
.day_input input{
	width:40px;
}
.isFree{
	background-color: grey;
}
.dayCell{
	height: 20px;
}
.ot{
	float: left;
	background-color: #99CDFF;
	padding:40px;
}
.step{
	float:left;
}
.step .name{
	border: 1px solid black;
	background-color: white;
	margin: 8px;
	border-radius: 3px;
}
.step .date{
	border: 1px solid black;
	background-color: white;
	margin-left: 15px;
	border-radius: 3px;
	width:40px;
}
.step .flag{
    background-image: url(data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAA4AAwDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD6I/4KMftDa18BfhToLeFRHP4j1DW7e6+zF9rSWNgH1G9H0khtDb+7XSjjOR71oGtWvifRLPUrG4jurK/hS4gmRvlljdQysPYgg/jXyL/wUA1zVvBX7SHg/XL6z0/UPC6+FdXtrKL7W63MF2gW6umZPK2eXJFb2satvLKRIduCM+2fsNaBrHhj9kfwDYeIZLVr620qNYFsrh5YorMkmzj3sis7pbGFHYqMurdRyf0bKeIMXieJ8ZlVWH7qlGDi/N7/AHn8/YfMKksROhKNoxSafdybv18keM/8FSkzqngXPQ6d4l/9NlfR37PP/JAvA/8A2L9h/wCk0dfOX/BUv/kLeBf+wd4k/wDTZX0b+z1x8AvA/wD2L9h/6TR1hkMnLi3MX/cpflI5MK39eqa/Zj+cj5y/4Kl/8hbwL/2DvEn/AKbK+jf2ev8AkgXgf/sX7D/0mjr5y/4Kl/8AIW8C/wDYO8Sf+myvo39nr/kgXgf/ALF+w/8ASaOlkH/JV5l/gpfkwwv+/VP8MfzkfPX/AAVF0TV7+TwTdaZ4f8Ua7Db2uu2039jaJd6o8Ek9h5cQdLeORlDOcbiAvvX0T8DdPuNI+CXg21uobmzurXQrGKaCSMrJE626BlZTyrAggg8giiivXy/A0qebV8bH46kYp9tNtD0o4WnBqvH4pKz9Ft+Z/9k=");
    height: 57px;
    width: 10px;
    margin-left: 28px;
}
.step .clce{
	background-color: rgb(83, 198, 103);
	height: 8px;
	width: 8px;
	margin-left: 30px;
	border: 1px solid #000;
	border-radius: 3px;
}
.step .t1{
	background-color: rgb(83, 198, 103);
}
.step .t2{
	background-color: rgb(204, 255, 204);
}
.step .t3{
	background-color: red;
}
.ot .line {
    height: 2px;
    background-color: black;
    position: relative;
    top: 43px;
}
</style>
</head>
<body>

<div id="milk">

	<div class="day_input">
	起始天设置：<input v-model="beginYear" number/><input v-model="beginMonth" number/><input v-model="beginDay" number/>
	<br/>
	起始偏移量：<input v-model="start" number/><br/>
	时间列表长度：<input v-model="dayNum" number lazy/>
	<hr/>

	总工作日：{{totalDay}}
	<br/>	<br/>
	{{firstStepName}}
		<div v-for="step in steps">
		<input v-model="step.day" number/>天<br/>{{step.name}}
		</div>
	</div>




	<div class="day_list">
	    <div v-for="day in dayList">
		   	<div class="dayCell" v-bind:class="{'isFree':day.isFree}">
		      <input  type="checkbox"  v-model="day.isFree">W{{day.weekIndex}} : {{day.dateStr}}
		   	</div>
	    </div>
    </div>
    <div class="step_list">
	    <div v-for="day in stepList">
		   	<div class="dayCell" v-bind:class="{'isFree':day.isFree}">
		      {{day.stepName}}
		   	</div>
	    </div>
    </div>

	<div class="ot">
		<div class="line"></div>
		<div class="step" v-for="step in stepListForOT">
			<div class="name">{{step.stepName}}</div>
			<div class="clce {{step.type}}"></div>
			<div class="flag"></div>
			<div class="date">{{step.dateStr}}</div>
		</div>
	</div>

</div>



</body>
<script type="text/javascript">
new Vue({
	  el: '#milk',
	  data: {
	  	beginDay:new Date().getDate(),
	  	beginMonth:new Date().getMonth()+1,
	  	beginYear:new Date().getFullYear(),
	    dayNum: 50,
	    start:1,
	    firstStepName:'需求分析确认',
	    steps:[
				{day:3,name:"需求确认",type:"t1"},
				{day:3,name:"需求设计评审",type:"t1"},
				{day:3,name:"开始需求编码",type:"t1"},
				{day:3,name:"开始每日构建",type:"t2"},
				{day:3,name:"编码结束",type:"t1"},
				{day:3,name:"SDV1",type:"t2"},
				{day:3,name:"SDV2",type:"t2"},
				{day:3,name:"SIT测试环境验收",type:"t3"},
				{day:3,name:"现网升级",type:"t3"}
	    ]
	  },
	  computed: {
	  	totalDay:function(){
	  			var t = 0;
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				t+=this.steps[i].day;
	  			}
	  			return t;
	  	},
	    dayList:function() {
	  			var list=[];
	  			var bTime = new Date(this.beginYear,this.beginMonth-1,this.beginDay,0,0);
	  			for(i=1;i <= this.dayNum;i++)
	  			{
	  				var time = bTime.getTime();
	  				time += i*24*60*60*1000;
	  				var tempDate = new Date(time);
	  				var dateStr = tempDate.getFullYear()+"/"+(tempDate.getMonth() +1)+"/"+tempDate.getDate();
	  				//星期几
	  				var weekIndex = tempDate.getDay();
	  				if(weekIndex == 0){
	  					weekIndex = 7;
	  				}
	  				list.push({
	  					dateStr:dateStr,
	  					weekIndex:weekIndex,
	  					isFree:(weekIndex==6||weekIndex==7),
	  					stepName:""
	  				});
	  			}
	  			return list;
	  	},
	  	stepList:function(){
				var list=[];
	  			for(i=0;i < this.dayList.length;i++){
	  				list.push({
	  					dateStr:this.dayList[i].dateStr,
	  					weekIndex:this.dayList[i].weekIndex,
	  					isFree:this.dayList[i].isFree,
	  					stepName:""
	  				});
	  			}
	  			var temp = 0;
	  			temp += this.start;
	  			while(list[temp].isFree){
	  					temp++;
	  			}
	  			list[temp].stepName = this.firstStepName;
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				var j = 0;
	  				while(j<this.steps[i].day){
	  					if(list[temp].isFree){
	  						temp++;
	  						continue;
	  					}
	  					j++;
	  					temp++;
	  				}
	  				while(list[temp].isFree){
	  					temp++;
	  				}
	  				list[temp].stepName += (this.steps[i].name+";");
	  				list[temp].type = this.steps[i].type;
	  			}
	  			return list;
		  	
	  	},
	  	stepListForOT:function() {
				var list=[];
	  			for(i=0;i < this.stepList.length;i++){
	  				if(this.stepList[i].stepName != ""){
	  					var dateStr = this.stepList[i].dateStr;
	  					dateStr = dateStr.substr(5);
	  					dateStr = dateStr.replace('/','.');
		  				list.push({
		  					dateStr:dateStr,
		  					stepName:this.stepList[i].stepName.replace(';',''),
		  					type:this.stepList[i].type
		  				});
	  				}
	  			}
	  			return list;

	  	}
  	  },
	  methods: {

	  }
	});
</script>
</html>

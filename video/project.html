<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>工规划程进度</title>
	<script src="http://apps.bdimg.com/libs/vue/1.0.8/vue.min.js"></script>
<style type="text/css">
.day_input{
	position:absolute;
	top:230px;
}
.day_list{
	width: 155px;
	position: absolute;
	top: 230px;
	left: 260px;
}
.step_list{
	width: 200px;
	position: absolute;
	top: 230px;
	left: 415px;
}
.day_input input{
	width:40px;
}
.isFree{
	background-color: grey;
}
.dayCell{
	height: 20px;
}
.ot{
	float: left;
	background-color: #99CDFF;
	padding:40px;
}
.step{
	float:left;
}
.step .name{
	border: 1px solid black;
	background-color: white;
	margin: 8px;
	border-radius: 3px;
}
.step .date{
	border: 1px solid black;
	background-color: white;
	margin-left: 15px;
	border-radius: 3px;
	width:40px;
}
.step .flag1 {
    background-image: url("data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCABBABgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD6S+JX7U3xK+E3w58QeKta+DNxDo/hnTbjVb+SLxbatJHbwRNLIyhUySFQkAc5r54f/gor8dNahuL6KD4U6T5nmTppVzpV5ftaLnaLeS6F8sbsCR+8WHbkMccbT91+PfA+l/EvwNrXhzW7ZbzRfEFhPpt/AWMYmt5o2jkTcpDLlGYZBBGeCK/Meb9mDxdp/wC3B/wqex+KCtosdq1hZ61qXh97u6h1F7Q36WkipdxJJOunosnnjYh+YeTuJJ++40q5rhpUHgqtozkodPie3Q/nnOnmdWlFZZUjSlfVy1v2SunrufYHwM/bO+I3x6+G2n+JtJ+DMjWt1c3dmVbxfboUmtpZbaeMbkGUWaCUjIzt2EZBO0r174FfBbSf2e/hRpPg/Q5L2bT9JWVvPvJfOuLqWW4kuJppHwMySSzSSMV2/M3y7U+SivtMLhavsYqvO8ra6I9yWIktktls3+Op17jchHHTuMivz2k8H6s//BRdvCI17C/8LWHiP7d9k/fCIaL/AGh9l+//AM8gbXzM/wCqYjbj5a/Qqvhn/nL03/Y1/wDunmvjvELDwqSy9yvpiKdtWu54OZQjJUOb/n7D9T7m70UDpRX6JGKO6olzXXUK+Gf+cvTf9jX/AO6ea+5q+Gf+cvTf9jX/AO6ea+C483wH/YRS/NnHj/8Alz/18h+p9zDpRQOlFffRO2pv8hN9fDO7/jb23/Y2f+6ea+50G91GPvHHHJr5F/4UF46/4ed/8JgfC9wvg3+1xqw1v+0LHyPKPhwWO3yfP+1bvtLbOYNvGd2Onw/GmFr4l4L2MX7leEnpfRX7HPiaM6vslC2lSL3tor33PrkUUgPzccn0FFfac0vsr9DflnJJ2+53IR1qbRv+QbJ/1yX+T0UUL4PmFb44ev6FeL79FFFc+O+Jeh35L/Bf+Jn/2Q==");
    height: 66px;
    width: 27px;
    margin-left: 28px;
}
.ot .line {
    height: 2px;
    background-color: black;
    position: relative;
    top: 46px;
}
</style>
</head>
<body>

<div id="milk">

	<div class="day_input">
	起始天设置：<input v-model="beginYear" number/><input v-model="beginMonth" number/><input v-model="beginDay" number/>
	<br/>
	起始偏移量：<input v-model="start" number/><br/>
	时间列表长度：<input v-model="dayNum" number lazy/>
	<hr/>

	总工作日：{{totalDay}}
	<br/>	<br/>
	{{firstStepName}}
		<div v-for="step in steps">
		<input v-model="step.day" number/>天<br/>{{step.name}}
		</div>
	</div>




	<div class="day_list">
	    <div v-for="day in dayList">
		   	<div class="dayCell" v-bind:class="{'isFree':day.isFree}">
		      <input  type="checkbox"  v-model="day.isFree">W{{day.weekIndex}} : {{day.dateStr}}
		   	</div>
	    </div>
    </div>
    <div class="step_list">
	    <div v-for="day in stepList">
		   	<div class="dayCell" v-bind:class="{'isFree':day.isFree}">
		      {{day.stepName}}
		   	</div>
	    </div>
    </div>

	<div class="ot">
		<div class="line"></div>
		<div class="step" v-for="step in stepListForOT">
			<div class="name">{{step.stepName}}</div>
			<div class="flag1"></div>
			<div class="date">{{step.dateStr}}</div>
		</div>
	</div>

</div>



</body>
<script type="text/javascript">
new Vue({
	  el: '#milk',
	  data: {
	  	beginDay:new Date().getDate(),
	  	beginMonth:new Date().getMonth()+1,
	  	beginYear:new Date().getFullYear(),
	    dayNum: 50,
	    start:1,
	    firstStepName:'需求分析确认',
	    steps:[
				{day:3,name:"需求确认"},
				{day:3,name:"需求设计评审"},
				{day:3,name:"开始需求编码"},
				{day:3,name:"开始每日构建"},
				{day:3,name:"编码结束"},
				{day:3,name:"SDV1"},
				{day:3,name:"SDV2"},
				{day:3,name:"SIT测试环境验收"},
				{day:3,name:"现网升级"}
	    ]
	  },
	  computed: {
	  	totalDay:function(){
	  			var t = 0;
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				t+=this.steps[i].day;
	  			}
	  			return t;
	  	},
	    dayList:function() {
	  			var list=[];
	  			var bTime = new Date(this.beginYear,this.beginMonth-1,this.beginDay,0,0);
	  			for(i=1;i <= this.dayNum;i++)
	  			{
	  				var time = bTime.getTime();
	  				time += i*24*60*60*1000;
	  				var tempDate = new Date(time);
	  				var dateStr = tempDate.getFullYear()+"/"+(tempDate.getMonth() +1)+"/"+tempDate.getDate();
	  				//星期几
	  				var weekIndex = tempDate.getDay();
	  				if(weekIndex == 0){
	  					weekIndex = 7;
	  				}
	  				list.push({
	  					dateStr:dateStr,
	  					weekIndex:weekIndex,
	  					isFree:(weekIndex==6||weekIndex==7),
	  					stepName:""
	  				});
	  			}
	  			return list;
	  	},
	  	stepList:function(){
				var list=[];
	  			for(i=0;i < this.dayList.length;i++){
	  				list.push({
	  					dateStr:this.dayList[i].dateStr,
	  					weekIndex:this.dayList[i].weekIndex,
	  					isFree:this.dayList[i].isFree,
	  					stepName:""
	  				});
	  			}
	  			var temp = 0;
	  			temp += this.start;
	  			while(list[temp].isFree){
	  					temp++;
	  			}
	  			list[temp].stepName = this.firstStepName;
	  			for(i=0;i < this.steps.length;i++)
	  			{
	  				var j = 0;
	  				while(j<this.steps[i].day){
	  					if(list[temp].isFree){
	  						temp++;
	  						continue;
	  					}
	  					j++;
	  					temp++;
	  				}
	  				while(list[temp].isFree){
	  					temp++;
	  				}
	  				list[temp].stepName += (this.steps[i].name+";");
	  			}
	  			return list;
		  	
	  	},
	  	stepListForOT:function() {
				var list=[];
	  			for(i=0;i < this.stepList.length;i++){
	  				if(this.stepList[i].stepName != ""){
	  					var dateStr = this.stepList[i].dateStr;
	  					dateStr = dateStr.substr(5);
	  					dateStr = dateStr.replace('/','.');
		  				list.push({
		  					dateStr:dateStr,
		  					stepName:this.stepList[i].stepName.replace(';','')
		  				});
	  				}
	  			}
	  			return list;

	  	}
  	  },
	  methods: {

	  }
	});
</script>
</html>
